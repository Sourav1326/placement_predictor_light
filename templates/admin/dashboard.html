<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¯ Admin Dashboard - Placement Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
        .main-content {
            margin-top: 20px;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid;
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card.primary { border-left-color: #667eea; }
        .stat-card.success { border-left-color: #28a745; }
        .stat-card.warning { border-left-color: #ffc107; }
        .stat-card.info { border-left-color: #17a2b8; }
        .stat-card.danger { border-left-color: #dc3545; }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .stat-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            opacity: 0.7;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            height: 400px;
        }
        .admin-action {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: block;
            margin-bottom: 15px;
            border: 2px solid transparent;
        }
        .admin-action:hover {
            transform: translateY(-5px);
            color: inherit;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        .admin-action i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 10px 25px;
            font-weight: 600;
        }
        .recent-users {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        .user-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        .user-item:last-child {
            border-bottom: none;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-weight: bold;
        }
        .system-health {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-shield-alt"></i> Admin Dashboard
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                            <i class="fas fa-home"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('system_analytics') }}">
                            <i class="fas fa-chart-bar"></i> Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('train_models') }}">
                            <i class="fas fa-brain"></i> ML Models
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('student_profiles') }}">
                            <i class="fas fa-users"></i> Student Profiles
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-shield"></i> {{ current_user.first_name }}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-content">
        <!-- System Health -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="system-health">
                    <h2><i class="fas fa-server"></i> System Status</h2>
                    <p class="mb-3">All systems operational â€¢ Last updated: {{ current_time.strftime('%B %d, %Y at %I:%M %p') }}</p>
                    <div class="row">
                        <div class="col-md-3">
                            <strong>Database:</strong> <i class="fas fa-check-circle text-success"></i> Online
                        </div>
                        <div class="col-md-3">
                            <strong>ML Models:</strong> <i class="fas fa-check-circle text-success"></i> Loaded
                        </div>
                        <div class="col-md-3">
                            <strong>API:</strong> <i class="fas fa-check-circle text-success"></i> Responsive
                        </div>
                        <div class="col-md-3">
                            <strong>Storage:</strong> <i class="fas fa-check-circle text-success"></i> Available
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card primary">
                    <div class="stat-number">
                        <i class="fas fa-users stat-icon"></i>
                        {{ analytics.total_students or 0 }}
                    </div>
                    <div class="stat-label">Total Students</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card success">
                    <div class="stat-number">
                        <i class="fas fa-tasks stat-icon"></i>
                        {{ analytics.recent_assessments or 0 }}
                    </div>
                    <div class="stat-label">Recent Assessments</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card warning">
                    <div class="stat-number">
                        <i class="fas fa-percentage stat-icon"></i>
                        {{ "%.1f"|format(analytics.average_placement_probability * 100) }}%
                    </div>
                    <div class="stat-label">Avg Placement Prob</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card info">
                    <div class="stat-number">
                        <i class="fas fa-chart-line stat-icon"></i>
                        {{ analytics.branch_distribution|length or 0 }}
                    </div>
                    <div class="stat-label">Active Branches</div>
                </div>
            </div>
        </div>

        <!-- Charts and Analytics -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-pie"></i> Branch Distribution</h5>
                    <canvas id="branchChart"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <h4 class="mb-3"><i class="fas fa-cogs"></i> Admin Actions</h4>
                
                <a href="{{ url_for('train_models') }}" class="admin-action">
                    <i class="fas fa-brain"></i>
                    <h6>Train ML Models</h6>
                    <p class="mb-0">Retrain placement prediction models</p>
                </a>
                
                <a href="{{ url_for('system_analytics') }}" class="admin-action">
                    <i class="fas fa-chart-bar"></i>
                    <h6>View Analytics</h6>
                    <p class="mb-0">Detailed system analytics and reports</p>
                </a>
                
                <a href="#" class="admin-action" onclick="exportData()">
                    <i class="fas fa-download"></i>
                    <h6>Export Data</h6>
                    <p class="mb-0">Download system data and reports</p>
                </a>
                
                <a href="#" class="admin-action" onclick="systemMaintenance()">
                    <i class="fas fa-tools"></i>
                    <h6>System Maintenance</h6>
                    <p class="mb-0">Database cleanup and optimization</p>
                </a>
            </div>
        </div>

        <!-- Recent Activity and Branch Statistics -->
        <div class="row">
            <div class="col-md-6">
                <h4 class="mb-3"><i class="fas fa-users"></i> Recent Registrations</h4>
                <div class="recent-users">
                    {% if recent_users %}
                        {% for user in recent_users %}
                        <div class="user-item">
                            <div class="user-avatar">
                                {{ user.first_name[0] }}{{ user.last_name[0] }}
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">{{ user.first_name }} {{ user.last_name }}</h6>
                                <small class="text-muted">{{ user.branch }} â€¢ {{ user.created_at|datetime }}</small>
                            </div>
                            <span class="badge bg-primary">{{ user.user_type }}</span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-user-plus fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No recent registrations</h5>
                            <p class="text-muted">New user registrations will appear here</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="col-md-6">
                <h4 class="mb-3"><i class="fas fa-building"></i> Branch Statistics</h4>
                <div class="recent-users">
                    {% if analytics.branch_distribution %}
                        {% for branch_data in analytics.branch_distribution %}
                        <div class="user-item">
                            <div class="user-avatar">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">{{ branch_data.branch }}</h6>
                                <small class="text-muted">{{ branch_data.count }} students enrolled</small>
                            </div>
                            <div class="text-end">
                                <div class="progress" style="width: 100px; height: 8px;">
                                    <div class="progress-bar bg-primary" style="width: {{ (branch_data.count / analytics.total_students * 100) if analytics.total_students else 0 }}%"></div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No branch data</h5>
                            <p class="text-muted">Branch statistics will appear here</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        // Branch Distribution Chart
        const ctx = document.getElementById('branchChart').getContext('2d');
        const branchData = {{ analytics.branch_distribution | tojson }};
        
        if (branchData && branchData.length > 0) {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: branchData.map(item => item.branch),
                    datasets: [{
                        data: branchData.map(item => item.count),
                        backgroundColor: [
                            '#667eea', '#764ba2', '#f093fb', '#f5576c', 
                            '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        } else {
            // Show no data message
            ctx.canvas.parentElement.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No branch data available</h5>
                    <p class="text-muted">Charts will appear when students register</p>
                </div>
            `;
        }

        // Admin action functions
        function exportData() {
            // Implement data export functionality
            alert('Data export feature coming soon!');
        }

        function systemMaintenance() {
            if (confirm('Are you sure you want to run system maintenance? This may take a few minutes.')) {
                // Implement maintenance functionality
                alert('System maintenance started. You will be notified when complete.');
            }
        }
    </script>
</body>
</html>