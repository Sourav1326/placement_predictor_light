<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Analytics - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #f8f9fa; }
        .main-content { margin-top: 80px; padding: 20px 0; }
        .analytics-card { 
            background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            padding: 30px; margin-bottom: 20px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 25px; border-radius: 15px; text-align: center;
            margin-bottom: 15px;
        }
        .chart-container { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            height: 350px;
            position: relative;
            margin-bottom: 20px;
        }
        .chart-wrapper {
            position: relative;
            height: 250px;
            width: 100%;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            .chart-wrapper {
                height: 200px;
            }
            .stat-card {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-graduation-cap"></i> Admin Panel
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('admin_dashboard') }}">Dashboard</a>
                <a class="nav-link active" href="{{ url_for('system_analytics') }}">Analytics</a>
                <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <div class="analytics-card">
            <h2><i class="fas fa-chart-line"></i> System Analytics & Reports</h2>
            <p class="text-muted">Comprehensive insights into system performance and usage</p>
            
            <!-- Key Metrics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{ analytics.total_students or 0 }}</h3>
                        <p>Total Students</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{ analytics.recent_assessments or 0 }}</h3>
                        <p>Assessments Taken</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{ "%.1f"|format((analytics.average_placement_probability or 0) * 100) }}%</h3>
                        <p>Avg Placement Prob</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h3>{{ analytics.active_users or 0 }}</h3>
                        <p>Active Users</p>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Charts -->
            <div class="row">
                <div class="col-md-6">
                    <div class="chart-container">
                        <h5><i class="fas fa-chart-pie"></i> User Activity</h5>
                        <div class="chart-wrapper">
                            <canvas id="activityChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <h5><i class="fas fa-chart-bar"></i> Placement Trends</h5>
                        <div class="chart-wrapper">
                            <canvas id="trendsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Detailed Reports -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h5><i class="fas fa-table"></i> Detailed Analytics</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Value</th>
                                    <th>Change</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Total Registrations</td>
                                    <td>{{ analytics.total_students or 0 }}</td>
                                    <td><span class="text-success">+5.2%</span></td>
                                    <td><i class="fas fa-arrow-up text-success"></i></td>
                                </tr>
                                <tr>
                                    <td>Skill Assessments</td>
                                    <td>{{ analytics.recent_assessments or 0 }}</td>
                                    <td><span class="text-success">+12.1%</span></td>
                                    <td><i class="fas fa-arrow-up text-success"></i></td>
                                </tr>
                                <tr>
                                    <td>Course Completions</td>
                                    <td>{{ analytics.course_completions or 0 }}</td>
                                    <td><span class="text-warning">+2.3%</span></td>
                                    <td><i class="fas fa-arrow-up text-warning"></i></td>
                                </tr>
                                <tr>
                                    <td>System Uptime</td>
                                    <td>99.8%</td>
                                    <td><span class="text-success">+0.1%</span></td>
                                    <td><i class="fas fa-check text-success"></i></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Export Options -->
            <div class="text-center mt-4">
                <button class="btn btn-outline-primary me-2" onclick="exportReport('pdf')">
                    <i class="fas fa-file-pdf"></i> Export PDF
                </button>
                <button class="btn btn-outline-success me-2" onclick="exportReport('excel')">
                    <i class="fas fa-file-excel"></i> Export Excel
                </button>
                <button class="btn btn-outline-info" onclick="refreshData()">
                    <i class="fas fa-sync"></i> Refresh Data
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        new Chart(activityCtx, {
            type: 'doughnut',
            data: {
                labels: ['Active Users', 'Inactive Users', 'New Registrations'],
                datasets: [{
                    data: [65, 25, 10],
                    backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: true,
                aspectRatio: 1.5,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }
            }
        });

        const trendsCtx = document.getElementById('trendsChart').getContext('2d');
        new Chart(trendsCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Placement Rate',
                    data: [65, 68, 72, 75, 78, 82],
                    borderColor: '#667eea',
                    tension: 0.4
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: true,
                aspectRatio: 2,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        function exportReport(format) {
            alert(`Exporting report in ${format.toUpperCase()} format...`);
        }

        function refreshData() {
            location.reload();
        }
    </script>
</body>
</html>