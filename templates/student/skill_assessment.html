<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programming Skill Assessment - Placement Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .main-content { margin-top: 80px; padding: 20px 0; }
        .assessment-card { 
            background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            padding: 40px; margin-bottom: 30px; border: none;
        }
        .language-card { 
            border: 3px solid #e9ecef; border-radius: 15px; padding: 25px; margin: 15px 0; 
            cursor: pointer; transition: all 0.3s ease; background: white;
            transform: translateY(0); box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .language-card:hover { 
            border-color: #667eea; transform: translateY(-5px); 
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        .language-card.selected { 
            border-color: #667eea; background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%); 
            transform: translateY(-3px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border: none; padding: 15px 40px; border-radius: 25px; font-weight: 600;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .quiz-section { display: none; }
        .question-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px; padding: 30px; margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        .option-btn {
            border: 2px solid #e9ecef; border-radius: 12px; padding: 15px 20px;
            margin: 8px 0; transition: all 0.3s ease; background: white;
            cursor: pointer; display: block; width: 100%; text-align: left;
        }
        .option-btn:hover {
            border-color: #667eea; background: #f8f9ff;
            transform: translateX(5px);
        }
        .option-btn.selected {
            border-color: #667eea; background: #667eea; color: white;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }
        .timer-display {
            font-size: 1.5rem; font-weight: bold; color: #667eea;
            background: white; padding: 10px 20px; border-radius: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .progress-custom {
            height: 8px; border-radius: 10px; background: #e9ecef;
        }
        .progress-bar-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px; transition: width 0.3s ease;
        }
        .results-section { display: none; }
        .score-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 25px; border-radius: 15px; margin: 15px 0;
            text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .score-card.intermediate {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
        }
        .score-card.beginner {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
        }
        .navbar-brand { font-weight: 700; font-size: 1.5rem; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('student_dashboard') }}">
                <i class="fas fa-graduation-cap me-2"></i> Placement Predictor
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('student_dashboard') }}">Dashboard</a>
                <a class="nav-link active" href="{{ url_for('skill_assessment') }}">Skill Assessment</a>
                <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <!-- Language Selection Section -->
        <div id="languageSelection" class="assessment-card">
            <div class="text-center mb-4">
                <h1><i class="fas fa-code me-3"></i>Programming Skill Assessment</h1>
                <p class="lead text-muted">Test your programming knowledge with interactive quizzes</p>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Assessment Details</h6>
                        <ul class="mb-0 small">
                            <li>3 difficulty levels: Beginner, Intermediate, Advanced</li>
                            <li>5 questions per level (15 questions total per language)</li>
                            <li>Multiple choice questions with explanations</li>
                            <li>Instant feedback and scoring</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="alert alert-success">
                        <h6><i class="fas fa-trophy me-2"></i>What You'll Get</h6>
                        <ul class="mb-0 small">
                            <li>Detailed proficiency analysis</li>
                            <li>Skill level assessment per language</li>
                            <li>Personalized learning recommendations</li>
                            <li>Progress tracking and improvement tips</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h5 class="mb-3"><i class="fas fa-laptop-code me-2"></i>Select Programming Languages:</h5>
            <div class="row">
                <div class="col-md-3">
                    <div class="language-card" data-language="python">
                        <div class="text-center">
                            <i class="fab fa-python fa-3x mb-3" style="color: #3776ab;"></i>
                            <h5>Python</h5>
                            <p class="small text-muted mb-0">Data Science • Web Dev • AI/ML</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="language-card" data-language="java">
                        <div class="text-center">
                            <i class="fab fa-java fa-3x mb-3" style="color: #ed8b00;"></i>
                            <h5>Java</h5>
                            <p class="small text-muted mb-0">Enterprise • Android • Backend</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="language-card" data-language="javascript">
                        <div class="text-center">
                            <i class="fab fa-js-square fa-3x mb-3" style="color: #f7df1e;"></i>
                            <h5>JavaScript</h5>
                            <p class="small text-muted mb-0">Frontend • Backend • Mobile</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="language-card" data-language="c++">
                        <div class="text-center">
                            <i class="fas fa-code fa-3x mb-3" style="color: #00599c;"></i>
                            <h5>C++</h5>
                            <p class="small text-muted mb-0">System • Game Dev • Competitive</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button type="button" class="btn btn-primary btn-lg" onclick="startAssessment()">
                    <i class="fas fa-rocket me-2"></i>Start Interactive Assessment
                </button>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quizSection" class="quiz-section">
            <div class="assessment-card">
                <div class="row mb-4">
                    <div class="col-md-8">
                        <h3><i class="fas fa-brain me-2"></i><span id="currentLanguage">Python</span> Assessment</h3>
                        <p class="text-muted">Level: <span id="currentLevel" class="badge bg-primary">Beginner</span></p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="timer-display" id="questionTimer">00:45</div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small text-muted">Progress: <span id="currentQuestionNum">1</span> of <span id="totalQuestions">15</span></span>
                            <span class="small text-muted">Score: <span id="currentScore">0</span>/<span id="maxScore">15</span></span>
                        </div>
                        <div class="progress-custom">
                            <div class="progress-bar-custom" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="question-card">
                    <h5 id="questionText">Loading question...</h5>
                    <div id="questionOptions" class="mt-4"></div>
                </div>

                <div class="row mt-4">
                    <div class="col-6">
                        <button class="btn btn-outline-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                            <i class="fas fa-arrow-left me-2"></i>Previous
                        </button>
                    </div>
                    <div class="col-6 text-end">
                        <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">
                            Next<i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <div class="assessment-card">
                <div class="text-center mb-4">
                    <h2><i class="fas fa-trophy me-3"></i>Assessment Complete!</h2>
                    <p class="lead">Here's your detailed skill analysis</p>
                </div>
                
                <div id="languageResults"></div>
                
                <div class="mt-4">
                    <h4><i class="fas fa-lightbulb me-2"></i>Personalized Recommendations</h4>
                    <div id="recommendations" class="mt-3"></div>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-primary me-3" onclick="retakeAssessment()">
                        <i class="fas fa-redo me-2"></i>Retake Assessment
                    </button>
                    <a href="{{ url_for('student_dashboard') }}" class="btn btn-outline-primary">
                        <i class="fas fa-home me-2"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedLanguages = [];
        let currentLanguageIndex = 0;
        let currentQuestionIndex = 0;
        let currentLevel = 'beginner';
        let currentLevelIndex = 0;
        let questionsPerLevel = 5;
        let userAnswers = {};
        let assessmentData = {};
        let questionTimer;
        let timeLeft = 45;
        
        const levels = ['beginner', 'intermediate', 'advanced'];
        const levelNames = {'beginner': 'Beginner', 'intermediate': 'Intermediate', 'advanced': 'Advanced'};

        document.addEventListener('DOMContentLoaded', function() {
            const languageCards = document.querySelectorAll('.language-card');
            languageCards.forEach(card => {
                card.addEventListener('click', function() {
                    const language = this.dataset.language;
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedLanguages = selectedLanguages.filter(l => l !== language);
                    } else {
                        this.classList.add('selected');
                        selectedLanguages.push(language);
                    }
                });
            });
        });

        function startAssessment() {
            if (selectedLanguages.length === 0) {
                alert('Please select at least one programming language');
                return;
            }
            
            // Call the existing assessment endpoint
            fetch('/conduct-assessment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ languages: selectedLanguages.join(',') })
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // Display actual results from existing endpoint
                      displayResults(data.detailed_results, data.report);
                  } else {
                      alert('Assessment error: ' + data.message);
                  }
              }).catch(error => {
                  console.error('Assessment error:', error);
                  alert('Error conducting assessment. Please try again.');
              });
        }

        function displayResults(results, report) {
            document.getElementById('languageSelection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            const resultsContainer = document.getElementById('languageResults');
            resultsContainer.innerHTML = '';
            
            selectedLanguages.forEach(language => {
                const langResult = results[language];
                const proficiency = langResult.proficiency_level;
                
                const resultCard = document.createElement('div');
                resultCard.className = `score-card ${proficiency}`;
                resultCard.innerHTML = `
                    <h4><i class="fas fa-code me-2"></i>${language.charAt(0).toUpperCase() + language.slice(1)}</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <h3>${langResult.overall_score}/${langResult.total_questions}</h3>
                            <p>Overall Score</p>
                        </div>
                        <div class="col-md-4">
                            <h3>${langResult.overall_percentage.toFixed(1)}%</h3>
                            <p>Accuracy</p>
                        </div>
                        <div class="col-md-4">
                            <h3>${proficiency.charAt(0).toUpperCase() + proficiency.slice(1)}</h3>
                            <p>Proficiency Level</p>
                        </div>
                    </div>
                `;
                resultsContainer.appendChild(resultCard);
            });
            
            // Display recommendations
            const recommendationsContainer = document.getElementById('recommendations');
            if (report.improvement_areas && report.improvement_areas.length > 0) {
                const improvementDiv = document.createElement('div');
                improvementDiv.className = 'alert alert-warning';
                improvementDiv.innerHTML = `
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Areas for Improvement:</h6>
                    <ul class="mb-0">
                        ${report.improvement_areas.map(area => `<li>${area}</li>`).join('')}
                    </ul>
                `;
                recommendationsContainer.appendChild(improvementDiv);
            }
            
            if (report.recommendations && report.recommendations.length > 0) {
                const recDiv = document.createElement('div');
                recDiv.className = 'alert alert-info';
                recDiv.innerHTML = `
                    <h6><i class="fas fa-lightbulb me-2"></i>Personalized Recommendations:</h6>
                    <ul class="mb-0">
                        ${report.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                `;
                recommendationsContainer.appendChild(recDiv);
            }
        }

        function retakeAssessment() {
            selectedLanguages = [];
            document.querySelectorAll('.language-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('languageSelection').style.display = 'block';
        }
    </script>
</body>
</html>