<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Placement Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #f8f9fa; }
        .main-content { margin-top: 80px; padding: 20px 0; }
        .profile-card { 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            padding: 30px; 
            margin-bottom: 20px; 
        }
        .form-control:focus { border-color: #667eea; box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; }
        .language-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 5px 10px; border-radius: 15px; margin: 2px;
            font-size: 0.8rem; display: inline-block;
        }
        .language-tag.unverified {
            background: #6c757d; position: relative;
        }
        .verify-btn {
            background: #28a745; color: white; border: none;
            padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;
            margin-left: 5px; cursor: pointer;
        }
        .verify-btn:hover { background: #218838; }
        .language-input-container { position: relative; }
        .language-suggestions {
            position: absolute; top: 100%; left: 0; right: 0; background: white;
            border: 1px solid #ddd; border-radius: 5px; z-index: 1000;
            max-height: 200px; overflow-y: auto; display: none;
        }
        .language-suggestions .suggestion-item {
            padding: 10px; cursor: pointer; border-bottom: 1px solid #eee;
        }
        .language-suggestions .suggestion-item:hover { background: #f8f9fa; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('student_dashboard') }}">
                <i class="fas fa-graduation-cap"></i> Placement Predictor
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('student_dashboard') }}">Dashboard</a>
                <a class="nav-link active" href="{{ url_for('profile') }}">Profile</a>
                <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <div class="row">
            <div class="col-12">
                <div class="profile-card">
                    <h2><i class="fas fa-user"></i> My Profile</h2>
                    <p class="text-muted">Update your academic and professional information</p>
                    
                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <form method="POST" action="{{ url_for('update_profile') }}">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-3"><i class="fas fa-graduation-cap"></i> Academic Information</h5>
                                
                                <div class="mb-3">
                                    <label for="cgpa" class="form-label">Current CGPA</label>
                                    <input type="number" class="form-control" id="cgpa" name="cgpa" 
                                           step="0.01" min="0" max="10" value="{{ profile.cgpa or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="tenth_percentage" class="form-label">10th Grade Percentage</label>
                                    <input type="number" class="form-control" id="tenth_percentage" name="tenth_percentage" 
                                           step="0.01" min="0" max="100" value="{{ profile.tenth_percentage or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="twelfth_percentage" class="form-label">12th Grade Percentage</label>
                                    <input type="number" class="form-control" id="twelfth_percentage" name="twelfth_percentage" 
                                           step="0.01" min="0" max="100" value="{{ profile.twelfth_percentage or '' }}">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="mb-3"><i class="fas fa-code"></i> Technical Skills</h5>
                                
                                <div class="mb-3">
                                    <label for="programming_languages" class="form-label">Programming Languages</label>
                                    <div class="language-input-container">
                                        <input type="text" class="form-control" id="programming_languages" name="programming_languages" 
                                               placeholder="Type languages (e.g., Python, Java, JavaScript...)" 
                                               value="{{ profile.programming_languages or '' }}"
                                               onkeyup="showLanguageSuggestions(this.value)"
                                               onblur="hideLanguageSuggestions()">
                                        <div class="language-suggestions" id="languageSuggestions"></div>
                                    </div>
                                    <small class="text-muted">Add languages you're proficient in. You'll be asked to verify them.</small>
                                    <div id="selectedLanguages" class="mt-2"></div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="leetcode_score" class="form-label">LeetCode Score</label>
                                    <input type="number" class="form-control" id="leetcode_score" name="leetcode_score" 
                                           min="0" max="3000" value="{{ profile.leetcode_score or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="codechef_rating" class="form-label">CodeChef Rating</label>
                                    <input type="number" class="form-control" id="codechef_rating" name="codechef_rating" 
                                           min="0" max="4000" value="{{ profile.codechef_rating or '' }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <h5 class="mb-3"><i class="fas fa-project-diagram"></i> Experience</h5>
                                
                                <div class="mb-3">
                                    <label for="num_projects" class="form-label">Number of Projects</label>
                                    <input type="number" class="form-control" id="num_projects" name="num_projects" 
                                           min="0" value="{{ profile.num_projects or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="num_internships" class="form-label">Number of Internships</label>
                                    <input type="number" class="form-control" id="num_internships" name="num_internships" 
                                           min="0" value="{{ profile.num_internships or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="num_certifications" class="form-label">Number of Certifications</label>
                                    <input type="number" class="form-control" id="num_certifications" name="num_certifications" 
                                           min="0" value="{{ profile.num_certifications or '' }}">
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <h5 class="mb-3"><i class="fas fa-users"></i> Soft Skills</h5>
                                
                                <div class="mb-3">
                                    <label for="communication_score" class="form-label">Communication Score (1-10)</label>
                                    <input type="number" class="form-control" id="communication_score" name="communication_score" 
                                           step="0.1" min="1" max="10" value="{{ profile.communication_score or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="leadership_score" class="form-label">Leadership Score (1-10)</label>
                                    <input type="number" class="form-control" id="leadership_score" name="leadership_score" 
                                           step="0.1" min="1" max="10" value="{{ profile.leadership_score or '' }}">
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <h5 class="mb-3"><i class="fas fa-trophy"></i> Extracurricular</h5>
                                
                                <div class="mb-3">
                                    <label for="num_hackathons" class="form-label">Number of Hackathons</label>
                                    <input type="number" class="form-control" id="num_hackathons" name="num_hackathons" 
                                           min="0" value="{{ profile.num_hackathons or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="club_participation" class="form-label">Club Participation</label>
                                    <input type="number" class="form-control" id="club_participation" name="club_participation" 
                                           min="0" value="{{ profile.club_participation or '' }}">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="online_courses" class="form-label">Online Courses Completed</label>
                                    <input type="number" class="form-control" id="online_courses" name="online_courses" 
                                           min="0" value="{{ profile.online_courses or '' }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="target_companies" class="form-label">Target Companies</label>
                                    <input type="text" class="form-control" id="target_companies" name="target_companies" 
                                           placeholder="Google, Microsoft, Amazon..." value="{{ profile.target_companies or '' }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="preferred_locations" class="form-label">Preferred Job Locations</label>
                                    <input type="text" class="form-control" id="preferred_locations" name="preferred_locations" 
                                           placeholder="Bangalore, Mumbai, Hyderabad..." value="{{ profile.preferred_locations or '' }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Update Profile
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const popularLanguages = [
            'Python', 'Java', 'JavaScript', 'C++', 'C#', 'C', 'PHP', 'TypeScript',
            'Swift', 'Kotlin', 'Go', 'Rust', 'Ruby', 'Scala', 'R', 'MATLAB',
            'HTML/CSS', 'SQL', 'Node.js', 'React', 'Angular', 'Vue.js'
        ];
        
        let selectedLanguagesList = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize selected languages from existing profile
            const existingLanguages = document.getElementById('programming_languages').value;
            if (existingLanguages) {
                selectedLanguagesList = existingLanguages.split(',').map(lang => lang.trim()).filter(lang => lang);
                updateSelectedLanguagesDisplay();
            }
        });
        
        function showLanguageSuggestions(value) {
            const suggestionsDiv = document.getElementById('languageSuggestions');
            
            if (value.length < 2) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            const matches = popularLanguages.filter(lang => 
                lang.toLowerCase().includes(value.toLowerCase()) && 
                !selectedLanguagesList.includes(lang)
            );
            
            if (matches.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            suggestionsDiv.innerHTML = matches.map(lang => 
                `<div class="suggestion-item" onclick="addLanguage('${lang}')">${lang}</div>`
            ).join('');
            
            suggestionsDiv.style.display = 'block';
        }
        
        function hideLanguageSuggestions() {
            setTimeout(() => {
                document.getElementById('languageSuggestions').style.display = 'none';
            }, 200);
        }
        
        function addLanguage(language) {
            if (!selectedLanguagesList.includes(language)) {
                selectedLanguagesList.push(language);
                updateSelectedLanguagesDisplay();
                updateLanguageInput();
                document.getElementById('programming_languages').value = '';
                document.getElementById('languageSuggestions').style.display = 'none';
            }
        }
        
        function removeLanguage(language) {
            selectedLanguagesList = selectedLanguagesList.filter(lang => lang !== language);
            updateSelectedLanguagesDisplay();
            updateLanguageInput();
        }
        
        function updateSelectedLanguagesDisplay() {
            const container = document.getElementById('selectedLanguages');
            container.innerHTML = selectedLanguagesList.map(lang => `
                <span class="language-tag unverified">
                    ${lang}
                    <button type="button" class="verify-btn" onclick="verifyLanguage('${lang}')" title="Take quiz to verify this language">
                        Verify
                    </button>
                    <button type="button" class="btn-close btn-sm" onclick="removeLanguage('${lang}')" style="font-size: 0.6rem; margin-left: 5px;"></button>
                </span>
            `).join('');
        }
        
        function updateLanguageInput() {
            document.getElementById('programming_languages').value = selectedLanguagesList.join(', ');
        }
        
        function verifyLanguage(language) {
            // Redirect to skill assessment with pre-selected language
            const confirmation = confirm(`Take a quick quiz to verify your ${language} proficiency?\n\nThis will help validate your skills and improve placement predictions.`);
            
            if (confirmation) {
                // Store the language to verify in localStorage
                localStorage.setItem('verifyLanguage', language);
                // Redirect to skill assessment
                window.open('/skill-assessment', '_blank');
            }
        }
        
        // Handle form submission with validation
        document.querySelector('form').addEventListener('submit', function(e) {
            if (selectedLanguagesList.length === 0) {
                e.preventDefault();
                alert('Please add at least one programming language to your profile.');
                return false;
            }
            
            const unverifiedLanguages = selectedLanguagesList.length;
            
            if (unverifiedLanguages > 0) {
                const proceed = confirm(`You have ${unverifiedLanguages} unverified language(s).

Verified languages carry more weight in placement predictions.

Do you want to continue saving your profile?`);
                
                if (!proceed) {
                    e.preventDefault();
                    return false;
                }
            }
        });
        
        // Handle Enter key in language input
        document.getElementById('programming_languages').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const value = this.value.trim();
                if (value && !selectedLanguagesList.includes(value)) {
                    addLanguage(value);
                }
            }
        });
    </script>
</body>
</html>